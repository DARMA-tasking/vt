###############################################################################
############## Warning this is a generated file---do not modify ###############
###############################################################################

name: PR tests (gcc-7, ubuntu, mpich, trace runtime, LB)

trigger:
  branches:
    include:
      - develop
      - 1.0.0*

pr:
  branches:
   include:
     - '*'


resources:
- repo: self

variables:
  tag: '$(Build.BuildId)'
  REPO: lifflander1/vt
  ARCH: amd64
  UBUNTU: 18.04
  COMPILER_TYPE: gnu
  COMPILER: gcc-7
  BUILD_TYPE: release
  ULIMIT_CORE: 0
  CODE_COVERAGE: 1
  VT_LB: 1
  VT_TRACE: 1
  VT_TRACE_RT: 1
  VT_MIMALLOC: 0
  VT_DOCS: 0
  VT_ASAN: 0
  VT_WERROR: 1
  VT_POOL: 1
  VT_EXTENDED_TESTS: 1
  VT_UNITY_BUILD: 1
  VT_ZOLTAN: 0
  VT_CI_BUILD: 1
  VT_DIAGNOSTICS: 1
  CACHE: "$(Agent.TempDirectory)/cache/"
  cache_name: ubuntu-gcc-7-cache
  build_root: "$(CACHE)/$(ARCH)-ubuntu-$(UBUNTU)-$(COMPILER)-cache/"
  TS: 0
  TS_YEAR: 0
  TS_MONTH: 0
  TS_DAY: 0

stages:
- stage: Build
  displayName: Build image
  jobs:
  - job: Build
    displayName: Build
    pool:
      name: 'vt-agent-pool'
    timeoutInMinutes: 180
    steps:
      - task: Bash@3
        displayName: Job setup
        inputs:
          targetType: 'inline'
          script: |
            source /etc/docker-setup.sh
